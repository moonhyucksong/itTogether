<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.bit.java72.dao.FeedDao">
  <resultMap type="Feed" id="FeedMap">
    <id     column="fno"      property="fno" />
    <result column="categry"    property="category" />
    <result column="contnt"      property="content" />
    <result column="cre_dt"   property="createDate" />
    <result column="max_headcnt" property="maxHeadCount"/>
    <result column="current_cnt" property="currentCount"/>
    <result column="meet_time" property="meetTime"/>
  </resultMap>
  
  <resultMap type="FriendFeed" id="FriendFeedMap">
    <id     column="fno"      property="fno" />
    <result column="categry"    property="category" />
    <result column="contnt"      property="content" />
    <result column="cre_dt"   property="createDate" />
    <result column="max_headcnt" property="maxHeadCount"/>
    <result column="current_cnt" property="currentCount"/>
    <result column="meet_time" property="meetTime"/>
    <result column="nicknm"    property="nickname" />
    <result column="pwd"      property="password" />
    <result column="hometwn" property="hometown"/>
    <result column="lat" property="latitude"/>
    <result column="lon" property="longitude"/>
    <result column="addr" property="address"/>
    <result column="mphoto" property="profilePicture"/>
  </resultMap>
 
 <!--  모임약속시간 이 현재시간보다 나중이어야 출력하는걸로 수정 -->
  <select id="list" resultMap="FriendFeedMap" parameterType="int">
  select 
   t1.nicknm,
   t1.NAME,
   t1.MPHOTO,
   t2.FNO,
   t2.CATEGRY,
   t2.MAX_HEADCNT,
   t2.CURRENT_CNT,
   t2.MEET_TIME,
   t2.CONTNT,
   t2.cre_dt,
   t2.TITLE
   from memb_t t1 left outer join feed_t t2 
   on t1.mno=t2.mno
   where t2.categry is not null and t2.meet_time > now() and t1.mno IN (select frdno from frd_t where mno=#{values} and state=2)
   ORDER by t2.cre_dt desc;
  </select>	
  
  <!--  모임약속시간 이 현재시간보다 나중이어야 출력하는걸로 수정 -->
  <select id="noneFriendFeed" resultMap="FriendFeedMap" parameterType="int">
  select 
   t1.nicknm,
   t1.NAME,	
   t1.MPHOTO,
   t2.fno,
   t2.CATEGRY,
   t2.MAX_HEADCNT,
   t2.CURRENT_CNT,
   t2.MEET_TIME,
   t2.CONTNT,
   t2.cre_dt,
   t2.TITLE
   from memb_t t1 left outer join feed_t t2
   on t1.mno=t2.mno
   where t2.categry is not null and t1.mno=#{values} and t2.meet_time > now()
  </select>
  
  <insert id="insert" parameterType="Feed">
  INSERT INTO 
  feed_t(mno,categry,contnt,cre_dt,title,max_headcnt,meet_time)
  VALUES (#{mno},#{category},#{content},now(),#{title},#{maxHeadCount},#{meetTime})
  </insert>
  
 <!-- 내정보 에서 밑에 게시물 출력 -->
   <select id="myActivityList" resultMap="FeedMap">
  select 
  t1.mno,
  t1.nicknm,
  t1.name,
  t1.MPHOTO,
  t2.FNO,
  t2.CATEGRY,
  t2.MAX_HEADCNT,
  t2.CURRENT_CNT,
  t2.MEET_TIME,
  t2.CONTNT,
  t2.cre_dt,
  t2.TITLE
  from memb_t t1 inner join feed_t t2 on t1.mno=t2.mno
  where t2.meet_time > now() and t2.mno = #{values}  
  or t2.fno IN (select t3.fno from JOINFRD_T t3 inner join feed_t t4 on t3.fno=t4.fno where t3.mno=#{values} and t4.meet_Time > now()) 
  </select>
 
 <select id="getDetail" resultMap="FriendFeedMap" parameterType="int">
  select 
   t1.nicknm,
   t1.name,
   t1.MPHOTO,
   t2.FNO,
   t2.CATEGRY,
   t2.MAX_HEADCNT,
   t2.CURRENT_CNT,
   t2.MEET_TIME,
   t2.CONTNT,
   t2.cre_dt,
   t2.TITLE
   from memb_t t1 inner join feed_t t2 
   on t2.fno= #{value} and t1.mno = t2.mno
  </select>
   <insert id="friendJoinActivity" parameterType="map">
      insert into joinedfrd_t(mno, fno) values(#{mno}, #{fno})
  </insert>

</mapper>

















