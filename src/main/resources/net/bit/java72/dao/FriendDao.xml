<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.bit.java72.dao.FriendDao">
  <resultMap type="FriendList" id="FListMap">
    <id     column="FRDNO" property="frdmno"/>
    <id		column="MNO"     property="mno"/>
    <result column="STATE"     property="state"/>
    <result column="FRD_DT"   property="friendDate"/>
  </resultMap>
    <resultMap type="Member" id="MemberMap">
    <id     column="mno"      property="mno" />
    <result column="email"    property="email"/>
    <result column="nicknm"   property="nickname" />
    <result column="pwd"      property="password" />
    <result column="cre_dt"   property="createDate" />
    <result column="hometwn"  property="hometown"/>
    <result column="lat"      property="latitude"/>
    <result column="lon"      property="longitude"/>
    <result column="addr"     property="address"/>
    <result column="mphoto"   property="profilePicture"/>
  </resultMap>
  
  <resultMap type="Search" id="SearchMap">
  	<result column="mno"		property="mno"/>
  	<result column="searchType"	property="searchType"/>
  	<result column="searchCnt"	property="searchCnt"/>
  </resultMap>

  <select id="frdList" parameterType="Int" resultType="int">
    SELECT *
    FROM FRD_T
    WHERE mno=#{values} and state=2
  </select>
  
  
  <select id="applyList" parameterType="Int" resultType="int">
    SELECT *
    FROM FRD_T
    WHERE mno=#{values} and state=3
  </select>
    
  <select id="applyList2" parameterType="Int" resultType="int">
    SELECT *
    FROM FRD_T
    WHERE mno=#{values} and state=1
  </select>
  	
  <select id="getFRD" parameterType="int">
  	SELECT * 
  	FROM memb_t
  	where mno=#{values}
  </select>
   
   
   <!-- 친구아닌사람 검색에서 친구 검색으로 수정 -->
  <select id="unFriendList" parameterType="Search" resultMap="MemberMap">
  	SELECT * 
  	FROM memb_t
  	WHERE mno IN (select frdno from frd_t where mno=#{mno} and state=2) and mno !=#{mno}
  	<include refid='search'></include>
  </select>
  
  <insert id="addFRD" parameterType="FriendList">
    INSERT INTO FRD_T(mno, frdno, state, frd_dt) 
    VALUES(#{mno}, #{frdmno},1, now())
  </insert>
  
  <insert id="addFRD2" parameterType="FriendList">
    INSERT INTO FRD_T(mno, frdno, state, frd_dt) 
    VALUES(#{mno}, #{frdmno},3, now())
  </insert>
  
  <update id="acceptFRD" parameterType="FriendList">
  UPDATE frd_t set state=2 where mno=#{mno} and frdno=#{frdmno} 
  </update>
  
  <delete id="deleteFRD" parameterType="FriendList">
  DELETE from FRD_T where mno=#{mno} and frdno=#{frdmno}
  </delete>

<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 1">
				and NAME like concat( '%', #{searchCnt}, '%' )
			</if>
			<if test="searchType == 2">
				and NICKNM like concat( '%', #{searchCnt}, '%' )
			</if>
			<if test="searchType == 3">
				and EMAIL like concat( '%', #{searchCnt}, '%' )
			</if>
		</if>
</sql>
	
</mapper>















