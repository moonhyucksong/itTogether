<link rel='stylesheet' href="css/main_map.css" />
<div id="mainMap" onmousedown="return false"> 
</div>
<!-- infoModal에 있는 구글맵 id가 map이라 mainMap으로 명명-->


<div id="finder-box">
  <div class="radius-control">
    <div class="btn-group" data-toggle="buttons">
      <label class="btn btn-info btn-xs radius-500">
        <input type="radio" name="options" id="option500" value="500">500m</label>
      <label class="btn btn-info btn-xs radius-1000 active">
        <input type="radio" name="options" id="option1000" value="1000" checked>&nbsp;1km&nbsp;</label>     
      <label class="btn btn-info btn-xs radius-2000">
        <input type="radio" name="options" id="option2000" value="2000">2km</label>
    </div>
  </div>
  
  <div class="btn-group" data-toggle="buttons">
    <label class="btn btn-info btn-sm btn-manwoman radius-control1 active">
      <input type="radio" name="options" id="optionManWoman" autocomplete="off" checked><img src="images/icons/manwoman.png"></label>
    <label class="btn btn-info btn-sm btn-man radius-control1">
      <input type="radio" name="options" id="optionMan" autocomplete="off"><img src="images/icons/man.png"></label>
    <label class="btn btn-info btn-sm btn-woman radius-control1">
      <input type="radio" name="options" id="optionWoman" autocomplete="off"><img src="images/icons/woman.png"></label>
  </div>
  <br>
  <div class="btn-group" data-toggle="buttons">
    <label class="btn btn-info btn-sm btn-age radius-control2 btn-selected ">
      <input type="checkbox" autocomplete="off">나이</label>
    <label class="btn btn-info btn-sm btn-hobby radius-control2">
      <input type="checkbox" autocomplete="off">취미</label>
    <label class="btn btn-info btn-sm btn-hometown radius-control2">
      <input type="checkbox" autocomplete="off">고향</label>
  </div>
</div>


<div id="friend-box" onmousedown="return false">
  <div class="panel panel-info">
    <div class="panel-heading">
      <h3 class="panel-title panel-friend-title">친구 추천</h3>
    </div>
    <div class="panel-body panel-member">
    </div>
  </div>
</div>

<script>
  // json형식으로 받아온 나의 위치 데이터를 받아옴
  var myNickname,
      myIntro,
      myPhoto,
      myHobby,
      myHometown;
  var memberBtn = [];
  var myLoc = [];
  var friendLocArr = [];
  var notFriendLocArr = [];
  (function() {
    $.getJSON(contextRoot + '/member/getMyLoc.do', {
      mno: sessionStorage.getItem('mno')
    }, function(results) {
      myLoc[0] = parseFloat((results.data[0].latitude));
      myLoc[1] = parseFloat((results.data[0].longitude));
      myLoc[2] = Number(results.data[0].mno);
      myNickname = results.data[0].nickname;
      myIntro = results.data[0].introduction;
      myPhoto = results.data[0].profilePicture;
      mySex = results.data[0].sex;
      myAge = results.data[0].age;
      myHobby = results.data[0].hobby;
      myHometown = results.data[0].hometown;
    });
      
    $.getJSON(contextRoot + '/member/getFriends.do', {
      frdno: sessionStorage.getItem('mno'),
      mno: sessionStorage.getItem('mno')
    }, function(results) {
      for (var i = 0; i < results.data.length; i++) {
        var tempArr = [
          results.data[i].nickname,
          Number(results.data[i].latitude),
          Number(results.data[i].longitude),
          results.data[i].introduction,
          results.data[i].profilePicture,
          results.distance[i],
          results.data[i].sex,
          results.data[i].age,
          results.data[i].hobby,
          results.data[i].hometown
        ];
        friendLocArr.push(tempArr);
        console.log("친구" + i + ": " + friendLocArr[i][0]+"/"+ friendLocArr[i][5]+"/"+ friendLocArr[i][7]);
      }
    });
      
    $.getJSON(contextRoot + '/member/getMembers.do', {
      mno: sessionStorage.getItem('mno')
    }, function(results) {
      for (var i = 0; i < results.data.length; i++) {
        var tempArr = [
          results.data[i].nickname,
          Number(results.data[i].latitude),
          Number(results.data[i].longitude),
          results.data[i].introduction,
          results.data[i].profilePicture,
          results.distance[i],
          Number(results.data[i].mno),
          results.data[i].sex,
          results.data[i].age,
          results.data[i].hobby,
          results.data[i].hometown
        ];
        notFriendLocArr.push(tempArr);
        console.log("주변회원" + i + ": " + notFriendLocArr[i][0]+"/"+
                    notFriendLocArr[i][5]+"/"+notFriendLocArr[i][8]);
      }
      friendBoxD(1000);
    });
  })();

  var queryString1 = [];
  var queryString2 = [];
  var queryString3 = [];
  var queryString4 = [];
  function friendBoxD(distant) {
    $('.myPanel').remove();
    for (var i = 0; i < notFriendLocArr.length; i++) {
      memberBtn.push('#member'+notFriendLocArr[i][6]);
      if (notFriendLocArr[i][5] < distant) {
          if (notFriendLocArr[i][9] == myHobby && notFriendLocArr[i][10] == myHometown){
              queryString1.push('<div class="panel panel-info myPanel">' +
              '<div class="panel-heading match-heading">' +
              "BestMatch" +
              '</div>' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] +'">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '<div>취미와 고향이 일치합니다.</div>' +          
              '</div>' +
              '</div>');
          }
          if (notFriendLocArr[i][9] == myHobby && notFriendLocArr[i][10] != myHometown){
              queryString2.push('<div class="panel panel-info myPanel">' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] + '">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '<div>취미가 일치합니다.</div>' +          
              '</div>' +
              '</div>');
          }
          if (notFriendLocArr[i][9] != myHobby && notFriendLocArr[i][10] == myHometown) {
              queryString3.push('<div class="panel panel-info myPanel">' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] + '">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '<div>고향이 일치합니다.</div>' +          
              '</div>' +
              '</div>');
          }
          if (notFriendLocArr[i][9] != myHobby && notFriendLocArr[i][10] != myHometown) {
              queryString4.push('<div class="panel panel-info myPanel">' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] + '">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '</div>' +
              '</div>');
          }
      }
    }  
    queryStringSpin();
  }

  function friendBoxDS(distant, sex) {
    $('.myPanel').remove();
    for (var i = 0; i < notFriendLocArr.length; i++) {
      if (notFriendLocArr[i][5] < distant) {
        if (notFriendLocArr[i][7] == sex) {
          if (notFriendLocArr[i][9] == myHobby && notFriendLocArr[i][10] == myHometown){
              queryString1.push('<div class="panel panel-info myPanel">' +
              '<div class="panel-heading match-heading">' +
              "BestMatch" +
              '</div>' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] + '">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '<div>취미와 고향이 일치합니다.</div>' +          
              '</div>' +
              '</div>');
          }
          if (notFriendLocArr[i][9] == myHobby && notFriendLocArr[i][10] != myHometown){
              queryString2.push('<div class="panel panel-info myPanel">' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] + '">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '<div>취미가 일치합니다.</div>' +          
              '</div>' +
              '</div>');
          }
          if (notFriendLocArr[i][9] != myHobby && notFriendLocArr[i][10] == myHometown) {
              queryString3.push('<div class="panel panel-info myPanel">' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] + '">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '<div>고향이 일치합니다.</div>' +          
              '</div>' +
              '</div>');
          }
          if (notFriendLocArr[i][9] != myHobby && notFriendLocArr[i][10] != myHometown) {
              queryString4.push('<div class="panel panel-info myPanel">' +
              '<a href=""><div class="panel-body" id="member' + notFriendLocArr[i][6] + '">' +
              '<img src="' + notFriendLocArr[i][4] +'" class="img-circle match-friendimg"></a>' +
              notFriendLocArr[i][0] + '<br>' +
              notFriendLocArr[i][5] + 
              "m 이내" +
              '<input type="button" class="btn btn-info btn-xs addfriend-btn" mno-data = "' + notFriendLocArr[i][6] +'" value="친구추가">' +
              '</div>' +
              '</div>');
          }
        }
      }
    }
    queryStringSpin();
  }
  function queryStringSpin() {
    for (var i = 0; i < queryString1.length; i++) {
      $('#friend-box').append(queryString1[i]);
    }
    for (var i = 0; i < queryString2.length; i++) {
      $('#friend-box').append(queryString2[i]);
    }
    for (var i = 0; i < queryString3.length; i++) {
      $('#friend-box').append(queryString3[i]);
    }
    for (var i = 0; i < queryString4.length; i++) {
      $('#friend-box').append(queryString4[i]);
    }
    queryString1 = [];
    queryString2 = [];
    queryString3 = [];
    queryString4 = [];
  }
  
  var friendMarkers = []; /*팝업창 띄울 때의 마커들 */
  var notFriendMarkers = []; /* 팝업창 띄울 때의 마커들  */

  var map; // 맵객체에 필요
  var circle; // 주변 동그라미 그릴 변수
  var friendWindow = []; /* 친구들 팝업창 */
  var notFriendWindow = []; /* 회원들 팝업창 */

  var distant = 1000;;  //  거리 설정의 단위 변수 200m, 500m, 1km
  var sex = 0;
  var age = 0;
  var ageMin = 0;
  var ageMax = 0;
  var myRealHobby = 0;
  var myHobbyC = 0;
  var myRealHometown = 0;
  var myHometownC = 0;
    
    
  // 구글맵 초기화 함수.
  function initMap() {
    var radius = { /* 반경 보여줄 지점 */
      radiusCenter: {
        center: { lat: myLoc[0], lng: myLoc[1] },
        /* 반경의 중심 */
        population: 130 /* 반경 설정 200m: 26, 500m: 65, 1km: 130, 2km: 500*/
      }
    };
    
    // 구글맵을 보여줌
    map = new google.maps.Map(document.getElementById('mainMap'), {
      zoom: 15,
      /* 처음 화면을 보여주는 위도, 경도 */
      center: { lat: myLoc[0], lng: myLoc[1] },
      disableDefaultUI: true,
      /* DEFAULT UI 사용*/
      panControl: false,
      zoomControl: false,
      scaleControl: false /* 척도 */
    });

    markMyLoc(); // 나의 위치 마킹해줌
    distant = 1000;
    for (var i = 0; i < notFriendLocArr.length; i++) {
      console.log(notFriendLocArr[i]);
      if(notFriendLocArr[i][5] <= distant) {
        markNotFriends(i,1,1); /* 주변 회원 마킹 */
      } else {
        markNotFriends(i,0,0);   
      }
    }
    for (var i = 0; i < friendLocArr.length; i++) {
      console.log(friendLocArr[i])
      if(friendLocArr[i][5] <= distant) {
        markFriends(i,1,1); /* 친구 마킹 */
      } else {
        markFriends(i,0,0);
      }
    }
    markCircle(); /* 반경 렌더링 */

    function markMyLoc() {
      var marker = new google.maps.Marker({
        position: { lat: myLoc[0], lng: myLoc[1] },
        map: map,
        icon: 'images/icons/myHome.png'
      });
      
      marker.addListener('click', function() {
        myWindow.open(map, marker);
      });
      myWindow = new google.maps.InfoWindow({ /* 팝업창 생성 */
      content: "<div id='iw-container'>" +
        "<div class='iw-title'>" + myNickname + "</div>" +
        "<div class='iw-content'>" +
        "<div class='iw-subTitle'>" +
        "<img src=" + myPhoto + " class='img-circle iw-img'>" +
        "</div>" +
        "<div class='iw-subTitle'>" +
        "<textarea class='form-control' rows='2'>" +myIntro+ "</textarea>" +
        "</div>" +
        "</div>" +
        "</div>"
    });
    google.maps.event.addListener(myWindow, 'domready', function() {
      infoWindowsCSS(); // 팝업창 css 설정해줌
    });
    }

    function markFriends(i, mapAdj, dropAdj) {
      var friendLoc = friendLocArr[i];
      if (mapAdj == 0 && dropAdj == 0) {
          friendMarkers.push(new google.maps.Marker({
            title: friendLoc[0],
            position: { lat: friendLoc[1], lng: friendLoc[2] },
            icon: 'images/icons/friendHome.png'
          }));
      }
      if (mapAdj == 1 && dropAdj == 0) {
          friendMarkers.push(new google.maps.Marker({
            title: friendLoc[0],
            position: { lat: friendLoc[1], lng: friendLoc[2] },
            map: map,
            icon: 'images/icons/friendHome.png'
          }));
      }
      if (mapAdj == 1 && dropAdj == 1) {
          friendMarkers.push(new google.maps.Marker({
            title: friendLoc[0],
            position: { lat: friendLoc[1], lng: friendLoc[2] },
            map: map,
            animation: google.maps.Animation.DROP,
            icon: 'images/icons/friendHome.png'
          }));
      }
      friendMarkers[i].addListener('click', function() {
        if (friendMarkers[i].getAnimation() !== null) {
            friendMarkers[i].setAnimation(null);
            friendWindow[i].close(map, friendMarkers[i]);
        } else {
            friendMarkers[i].setAnimation(google.maps.Animation.BOUNCE);
            friendWindow[i].open(map, friendMarkers[i]);
        }
      });
      friendWindow[i] = new google.maps.InfoWindow({ /* 팝업창 생성 */
        content: "<div id='iw-container'>" +
          "<div class='iw-title'>" + friendLocArr[i][0] + "</div>" +
          "<div class='iw-content'>" +
          "<div class='iw-subTitle'>" +
          "<img src=" + friendLocArr[i][4] + " class='img-circle iw-img'>" +
          "</div>" +
          "<div class='iw-subTitle'>" +
          "<input type='txt' class='form-control input-xs' value=" + friendLocArr[i][3] + ">" +
          "</div>" +
          "</div>" +
          "</div>"
      });
      google.maps.event.addListener(friendWindow[i], 'domready', function() {
        infoWindowsCSS();// 팝업창 css 설정해줌
      });
    }
        
    function markNotFriends(i, mapAdj, dropAdj) {
      var notFriendLoc = notFriendLocArr[i];      
      if (mapAdj == 0 && dropAdj == 0) {
          notFriendMarkers.push(new google.maps.Marker({
            title: notFriendLoc[0],
            position: { lat: notFriendLoc[1], lng: notFriendLoc[2] },
            icon: 'images/icons/pin.png'
          }));
      }
      if (mapAdj == 1 && dropAdj == 0) {
          notFriendMarkers.push(new google.maps.Marker({
            title: notFriendLoc[0],
            position: { lat: notFriendLoc[1], lng: notFriendLoc[2] },
            map: map,
            icon: 'images/icons/pin.png'
        }));
      }
      if (mapAdj == 1 && dropAdj == 1) {
          notFriendMarkers.push(new google.maps.Marker({
            title: notFriendLoc[0],
            position: { lat: notFriendLoc[1], lng: notFriendLoc[2] },
            map: map,
            animation: google.maps.Animation.DROP,
            icon: 'images/icons/pin.png'
        }));
      }
      notFriendMarkers[i].addListener('click', function() {
        if (notFriendMarkers[i].getAnimation() !== null) {
            notFriendMarkers[i].setAnimation(null);
            notFriendWindow[i].close(map, notFriendMarkers[i]);
        } else {
            notFriendWindow[i].open(map, notFriendMarkers[i]);
            notFriendMarkers[i].setAnimation(google.maps.Animation.BOUNCE);
        }
      });
      notFriendWindow[i] = new google.maps.InfoWindow({ /* 팝업창 생성 */
        content: "<div id='iw-container'>" +
          "<div class='iw-title'>" + notFriendLocArr[i][0] + "</div>" +
          "<div class='iw-content'>" +
          "<div class='iw-subTitle'>" +
          "<img src='images/defaultProfilePicture.png' class='img-circle iw-img'>" +
          "</div>" +
          "<div class='iw-subTitle'>" +
          "<input type='txt' class='form-control input-xs' value=" + notFriendLocArr[i][3] + ">" +
        "<input type='button' class='btn btn-info btn-xs btn-block btn-addfriend' value='친구추가' mno-data='" + notFriendLocArr[i][6] + "'>" +
          "</div>" +
          "</div>" +
          "</div>"
      });
      google.maps.event.addListener(notFriendWindow[i], 'domready', function() {
        infoWindowsCSS();// 팝업창 css 설정해줌
      });
      
      $(document).off('click', memberBtn[i]);
      $(document).on('click', memberBtn[i], function(e) {  
        e.preventDefault();
        console.log(notFriendMarkers[i]);
        if (notFriendMarkers[i].getAnimation() !== null) {
            notFriendMarkers[i].setAnimation(null);
            notFriendWindow[i].close(map, notFriendMarkers[i]);
        } else {
            notFriendWindow[i].open(map, notFriendMarkers[i]);
            notFriendMarkers[i].setAnimation(google.maps.Animation.BOUNCE);
        }
      });
    }
    
    //info 윈도우 CSS 정의
  function infoWindowsCSS() {
      var iwOuter = $('.gm-style-iw');
      var iwBackground = iwOuter.prev();
      iwBackground.children(':nth-child(2)').css({
        'display': 'none'
      });
      iwBackground.children(':nth-child(4)').css({
        'display': 'none'
      });
      iwBackground.children(':nth-child(3)').find('div').children().css({
        'box-shadow': 'rgba(72, 181, 233, 0.6) 0px 1px 6px',
        'z-index': '1'
      });
      var iwCloseBtn = iwOuter.next();
      iwCloseBtn.css({
        opacity: '1',
        right: '28px',
        top: '16px',
        border: '0px solid #48b5e9',
        'border-radius': '4px'
      });
      iwCloseBtn.mouseout(function() {
        $(this).css({
          opacity: '1'
        });
      });
    }
    
  function markCircle() {
    for (var city in radius) {
      circle = new google.maps.Circle({
        strokeColor: '#000',
        /* 반경 렌더링 보더 색*/
        strokeOpacity: 0.4,
        strokeWeight: 1,
        fillColor: '#FFFFFF',
        /* 반경 렌더링 채움 색 */
        fillOpacity: 0.25,
        map: map,
        center: radius[city].center,
        radius: Math.sqrt(radius[city].population) * 100
      });
    }
  }
    
  function radiusDistance(m) { /* 반경 렌더링 거리 조정 함수 */
    radius = { /* 반경 보여줄때의 변수 */
      radiusCenter: {
        /* 반경의 중심 */
        center: { lat: myLoc[0], lng: myLoc[1] },
        population: m /* 반경 설정 200m: 4, 500m: 27, 1km: 97 */
      }
    };
    circle.setMap(null);
    markCircle();
  }  
    
  function dropMarkers(distant) {
    for (var i = 0; i < friendLocArr.length; i++) {
      if (friendLocArr[i][5] < distant) {
        markFriends(i,1,1); /* 친구 마킹 */
      } else {
        markFriends(i,0,0);
      }
    }
    for (var i = 0; i < notFriendLocArr.length; i++) {
      if (notFriendLocArr[i][5] < distant) {
        markNotFriends(i,1,1); /* 주변 회원 마킹 */
      } else {
        markNotFriends(i,0,0);
      }
    }
  }
  
    
    
    
    
    
    
    function renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC) {
    if (sex == 0 && age == 0 && myHobbyC == 0 && myHometownC == 0) { // 1. ABCD = 0
      console.log('========================================');
      console.log('CONDITION: None');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex != 0 && age == 0 && myHobbyC == 0 && myHometownC == 0) { // 2.  aBCD = 1
      console.log('========================================');
      console.log('CONDITION: sex');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][6] == sex) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant &&
            notFriendLocArr[i][7] == sex) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex == 0 && age != 0 && myHobbyC == 0 && myHometownC == 0) { // 3.  AbCD = 1
      console.log('========================================');
      console.log('CONDITION: age');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][7] >  ageMin  &&
            friendLocArr[i][7] <  ageMax){
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant &&
            notFriendLocArr[i][8] >  ageMin  &&
            notFriendLocArr[i][8] <  ageMax) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex == 0 && age == 0 && myHobbyC != 0 && myHometownC == 0) { // 4.  ABcD = 1
      console.log('========================================');
      console.log('CONDITION: hobby');
     for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][8] == myHobbyC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant &&
            notFriendLocArr[i][9] == myHobbyC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      } 
    }
    if (sex == 0 && age == 0 && myHobbyC == 0 && myHometownC != 0) { // 5.  ABCd = 1
      console.log('========================================');
      console.log('CONDITION: hometown');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant    &&
            friendLocArr[i][9] == myHometownC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant    &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex != 0 && age != 0 && myHobbyC == 0 && myHometownC == 0) { // 6.  abCD = 2
      console.log('========================================');
      console.log('CONDITION: sex, age');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][6] == sex     &&
            friendLocArr[i][7] >  ageMin  &&
            friendLocArr[i][7] <  ageMax) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant &&
            notFriendLocArr[i][7] == sex     &&
            notFriendLocArr[i][8] >  ageMin  &&
            notFriendLocArr[i][8] <  ageMax) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex == 0 && age != 0 && myHobbyC != 0 && myHometownC == 0) { // 7.  AbcD = 2
      console.log('========================================');
      console.log('CONDITION: age, hobby');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][7] >  ageMin  &&
            friendLocArr[i][7] <  ageMax  &&
            friendLocArr[i][8] == myHobbyC){
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant &&
            notFriendLocArr[i][8] >  ageMin  &&
            notFriendLocArr[i][8] <  ageMax  &&
            notFriendLocArr[i][9] == myHobbyC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex == 0 && age == 0 && myHobbyC != 0 && myHometownC != 0) { // 8.  ABcd = 2
      console.log('========================================');
      console.log('CONDITION: hobby, hometown');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant    &&
            friendLocArr[i][8] == myHobbyC    &&
            friendLocArr[i][9] == myHometownC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant    &&
            notFriendLocArr[i][9]  == myHobbyC    &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex != 0 && age == 0 && myHobbyC == 0 && myHometownC != 0) { // 9.  aBCd = 2
      console.log('========================================');
      console.log('CONDITION: sex, hometown');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][6] == sex     &&
            friendLocArr[i][9] == myHometownC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant    &&
            notFriendLocArr[i][7]  == sex        &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex != 0 && age == 0 && myHobbyC != 0 && myHometownC == 0) { // 10.  aBcD = 2
      console.log('========================================');
      console.log('CONDITION: sex, hobby');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][6] == sex     &&
            friendLocArr[i][8] == myHobbyC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant &&
            notFriendLocArr[i][7] == sex     &&
            notFriendLocArr[i][9] == myHobbyC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex == 0 && age != 0 && myHobbyC == 0 && myHometownC != 0) { // 11.  AbCd = 2
      console.log('========================================');
      console.log('CONDITION: age, hometown');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][7] >  ageMin  &&
            friendLocArr[i][7] <  ageMax  &&
            friendLocArr[i][9] == myHometownC){
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant &&
            notFriendLocArr[i][8]  >  ageMin  &&
            notFriendLocArr[i][8]  <  ageMax  &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex != 0 && age != 0 && myHobbyC != 0 && myHometownC == 0) { // 12. abcD = 3
      console.log('========================================');
      console.log('CONDITION: sex, age, hobby');
     for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][6] == sex     &&
            friendLocArr[i][7] >  ageMin  &&
            friendLocArr[i][7] <  ageMax  &&
            friendLocArr[i][8] == myHobbyC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5] <  distant &&
            notFriendLocArr[i][7] == sex     &&
            notFriendLocArr[i][8] >  ageMin  &&
            notFriendLocArr[i][8] <  ageMax  &&
            notFriendLocArr[i][9] == myHobbyC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      } 
    }
    if (sex != 0 && age != 0 && myHobbyC == 0 && myHometownC != 0) { // 13. abCd = 3
      console.log('========================================');
      console.log('CONDITION: sex, age, hometowns');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant &&
            friendLocArr[i][6] == sex     &&
            friendLocArr[i][7] >  ageMin  &&
            friendLocArr[i][7] <  ageMax  &&
            friendLocArr[i][9] == myHometownC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant &&
            notFriendLocArr[i][7]  == sex     &&
            notFriendLocArr[i][8]  >  ageMin  &&
            notFriendLocArr[i][8]  <  ageMax  &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex != 0 && age == 0 && myHobbyC != 0 && myHometownC != 0) { // 14. aBcd = 3
      console.log('========================================');
      console.log('CONDITION: sex, hobby, hometown');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant    &&
            friendLocArr[i][6] == sex        &&
            friendLocArr[i][8] == myHobbyC   &&
            friendLocArr[i][9] == myHometownC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant    &&
            notFriendLocArr[i][7]  == sex        &&
            notFriendLocArr[i][9]  == myHobbyC   &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex == 0 && age != 0 && myHobbyC != 0 && myHometownC != 0) { // 15. Abcd = 3
      console.log('========================================');
      console.log('CONDITION: age, hobby, hometown');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant    &&
            friendLocArr[i][7] >  ageMin     &&
            friendLocArr[i][7] <  ageMax     &&
            friendLocArr[i][8] == myHobbyC   &&
            friendLocArr[i][9] == myHometownC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant    &&
            notFriendLocArr[i][8]  >  ageMin     &&
            notFriendLocArr[i][8]  <  ageMax     &&
            notFriendLocArr[i][9]  == myHobbyC   &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
    if (sex != 0 && age != 0 && myHobbyC != 0 && myHometownC != 0) { // 16. abcd = 4
      console.log('========================================');
      console.log('CONDITION: sex, age, hobby, hometown');
      for (var i = 0; i < friendLocArr.length; i++) {
        if (friendLocArr[i][5] <  distant    &&
            friendLocArr[i][6] == sex        &&
            friendLocArr[i][7] >  ageMin     &&
            friendLocArr[i][7] <  ageMax     &&
            friendLocArr[i][8] == myHobbyC   &&
            friendLocArr[i][9] == myHometownC) {
          markFriends(i,1,0);
          console.log('#'+friendLocArr[i][0]);
        } else {
          markFriends(i,0,0);
        }
      }
      for (var i = 0; i < notFriendLocArr.length; i++) {
        if (notFriendLocArr[i][5]  <  distant    &&
            notFriendLocArr[i][7]  == sex        &&
            notFriendLocArr[i][8]  >  ageMin     &&
            notFriendLocArr[i][8]  <  ageMax     &&
            notFriendLocArr[i][9]  == myHobbyC   &&
            notFriendLocArr[i][10] == myHometownC) {
          markNotFriends(i,1,0);
          console.log('*'+notFriendLocArr[i][0]);
        } else {
          markNotFriends(i,0,0);
        }
      }
    }
  }

    
    // 거리 설정 후 마킹하기전 맵의 마커들을 없애주는 함수
  function clearMarkers() {
    for (var i = 0; i < friendMarkers.length; i++) {
      friendMarkers[i].setMap(null);
    }
    for (var i = 0; i < notFriendMarkers.length; i++) {
      notFriendMarkers[i].setMap(null);
    }
    friendMarkers = [];
    notFriendMarkers = [];
  }
    
  // 500m 버튼  
  $(document).on('click','.radius-500', function() {
    if (!($('.radius-500').hasClass('active'))) {
      distant = 500;
      clearMarkers();
      radiusDistance(27);
      dropMarkers(distant);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
    }
  });
  // 1000m 버튼
  $(document).on('click','.radius-1000', function() {
    if (!($('.radius-1000').hasClass('active'))) {
      distant = 1000;
      clearMarkers();
      radiusDistance(97);
      dropMarkers(distant);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
    }
  });
  // 2000m 버튼  
  $(document).on('click','.radius-2000', function() {
    if (!($('.radius-2000').hasClass('active'))) {
      distant = 2000;
      clearMarkers();
      radiusDistance(500);
      dropMarkers(distant);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
    }
  });
  
  // 남녀 모두 버튼   
  $(document).on('click', '.btn-manwoman', function() {
    if (!($('.btn-manwoman').hasClass('active'))) {
      sex = 0;
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
      console.log('PARAMETER: distant(' + distant + ')/sex(' + sex + ')/age(' + age + ')/ageMin(' + ageMin + ')/ageMax(' + ageMax + ')/myHobbyC(' + myHobbyC + ')/myHometownC(' + myHometownC + ')');
      console.log('========================================');
    }
  });
  // 남자 버튼
  $(document).on('click', '.btn-man', function() {
    if (!($('.btn-man').hasClass('active'))) {
      sex = 1;
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
      console.log('PARAMETER: distant(' + distant + ')/sex(' + sex + ')/age(' + age + ')/ageMin(' + ageMin + ')/ageMax(' + ageMax + ')/myHobbyC(' + myHobbyC + ')/myHometownC(' + myHometownC + ')');
      console.log('========================================');
    }
  });
  // 여자 버튼
  $(document).on('click', '.btn-woman', function() {
    if (!($('.btn-woman').hasClass('active'))) {
      sex = 2;  
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
      console.log('PARAMETER: distant(' + distant + ')/sex(' + sex + ')/age(' + age + ')/ageMin(' + ageMin + ')/ageMax(' + ageMax + ')/myHobbyC(' + myHobbyC + ')/myHometownC(' + myHometownC + ')');
      console.log('========================================');
    }
  });
    
  // 나이 버튼
  $(document).on('click', '.btn-age', function() {
    if (!($('.btn-age').hasClass('active'))) {
      age = 1;
      ageMin = myAge - 5;
      ageMax = myAge + 5;
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
      console.log('PARAMETER: distant(' + distant + ')/sex(' + sex + ')/age(' + age + ')/ageMin(' + ageMin + ')/ageMax(' + ageMax + ')/myHobbyC(' + myHobbyC + ')/myHometownC(' + myHometownC + ')');
      console.log('========================================');
    } else {
      age = 0;
      ageMin = 0;
      ageMax = 0;
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
    }
  });
  // 취미 버튼
  $(document).on('click', '.btn-hobby', function() {
    if (!($('.btn-hobby').hasClass('active'))) {
      myHobbyC = myHobby;
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
      console.log('PARAMETER: distant(' + distant + ')/sex(' + sex + ')/age(' + age + ')/ageMin(' + ageMin + ')/ageMax(' + ageMax + ')/myHobbyC(' + myHobbyC + ')/myHometownC(' + myHometownC + ')');
      console.log('========================================');
    } else {
      myHobbyC = 0;
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
    }
  });  
  // 고향 버튼
  $(document).on('click', '.btn-hometown', function() {
    if (!($('.btn-hometown').hasClass('active'))) {
      myHometownC = myHometown; 
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
      console.log('PARAMETER: distant(' + distant + ')/sex(' + sex + ')/age(' + age + ')/ageMin(' + ageMin + ')/ageMax(' + ageMax + ')/myHobbyC(' + myHobbyC + ')/myHometownC(' + myHometownC + ')');
      console.log('========================================');
    } else { 
      myHometownC = 0;
      clearMarkers();
      renderMarkers(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
//      friendBoxListCreater(distant, sex, age, ageMin, ageMax, myHobbyC, myHometownC);
    }
  });
   
} // initMap 끝 
  
  
  $(document).on('click', '.addfriend-btn', function() {
      var parent = this;
    $.ajax(contextRoot + '/frd/insert.do', {
        method: 'post',
        dataType: 'json',
        data: {
            frdmno: $(parent).attr('mno-data'),
            mno: sessionStorage.getItem('mno')
        },
      success: function(result) {
        alert('친구 요청을 보냈습니다.');
        $(this).attr('value', '친구 요청중');
        $(this).attr('disabled', true);
        }
      })
    });
  
  $(document).on('click', '.btn-addfriend', function() {
      var parent = this;
    $.ajax(contextRoot + 'frd/insert.do', {
        method: 'post',
        dataType: 'json',
        data: {
            frdmno: $(parent).attr('mno-data'),
            mno: sessionStorage.getItem('mno')
        },
      success: function(result) {
        alert('친구 요청을 보냈습니다.');
        $(this).attr('value', '친구 요청중');
        $(this).attr('disabled', true);
        }
      })
  });
  
  
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAg8yCYeg20PYuZR6w_hjMzkmeYfK_F9E4&callback=initMap" async defer></script>
